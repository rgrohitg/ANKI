<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immuta Data Portal | Salt Design</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            /* Salt UI Dark Theme Palette */
            --salt-bg-app: #161616;
            --salt-bg-surface: #1e1e1e;
            --salt-bg-active: #2d2d2d;
            --salt-border-color: #333333;
            --salt-text-primary: #ffffff;
            --salt-text-secondary: #aaaaaa;
            --salt-blue-accent: #4c88ff;
            --salt-status-success: #2dce98;
            --salt-status-error: #f5365c;
            --salt-status-warning: #fb6340;
        }

        body { 
            font-family: 'Inter', sans-serif;
            background-color: var(--salt-bg-app);
            color: var(--salt-text-primary);
            letter-spacing: -0.01em;
        }

        /* Salt UI Component Mimicry */
        .salt-card {
            background-color: var(--salt-bg-surface);
            border: 1px solid var(--salt-border-color);
            border-radius: 4px;
        }

        .salt-button-primary {
            background-color: var(--salt-blue-accent);
            color: white;
            transition: all 0.2s;
        }
        .salt-button-primary:hover {
            filter: brightness(1.1);
        }

        .salt-input {
            background-color: #121212;
            border: 1px solid var(--salt-border-color);
            color: white;
        }
        .salt-input:focus {
            border-color: var(--salt-blue-accent);
            outline: none;
        }

        .salt-table-header {
            background-color: #1a1a1a;
            border-bottom: 2px solid var(--salt-border-color);
        }

        .salt-status-pill {
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Custom Scrollbar for Dark Theme */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #161616; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }

        .active-tab {
            color: var(--salt-blue-accent);
            border-bottom: 2px solid var(--salt-blue-accent);
        }

        .metric-label {
            color: var(--salt-text-secondary);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body class="overflow-hidden">

    <div class="flex h-screen w-full">
        
        <!-- Sidebar Navigation (Salt Lab style) -->
        <aside class="w-16 flex flex-col items-center py-6 border-r border-[#333] bg-[#1a1a1a] z-50">
            <div class="w-10 h-10 bg-blue-600 rounded flex items-center justify-center mb-10">
                <i class="fas fa-shield-halved text-white"></i>
            </div>
            <nav class="flex flex-col space-y-8 text-slate-500">
                <button class="text-white"><i class="fas fa-chart-line text-lg"></i></button>
                <button class="hover:text-white transition-colors"><i class="fas fa-database text-lg"></i></button>
                <button class="hover:text-white transition-colors"><i class="fas fa-clock-rotate-left text-lg"></i></button>
                <button class="hover:text-white transition-colors"><i class="fas fa-cog text-lg"></i></button>
            </nav>
            <div class="mt-auto">
                <div class="w-8 h-8 rounded-full bg-slate-700 border border-slate-600"></div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden">
            
            <!-- Global Top Bar -->
            <header class="h-14 border-b border-[#333] bg-[#1a1a1a] flex items-center justify-between px-6">
                <div class="flex items-center space-x-4">
                    <h2 class="text-sm font-bold tracking-tight">IMMUTA <span class="text-blue-500">DATA PORTAL</span></h2>
                    <span class="px-2 py-0.5 bg-[#2a2a2a] text-[10px] rounded text-blue-400 border border-blue-900 font-mono">v4.2.1-stable</span>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="text-[11px] font-bold">
                        <span class="text-emerald-500"><i class="fas fa-circle text-[8px] mr-2"></i>GATEWAY CONNECTED</span>
                    </div>
                </div>
            </header>

            <!-- Dashboard Content -->
            <main class="flex-1 overflow-y-auto p-6 space-y-6">
                
                <!-- Metrics Grid -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="salt-card p-4">
                        <p class="metric-label">Total Volume</p>
                        <h3 class="text-2xl font-bold mt-1" id="stat-total">0</h3>
                        <p class="text-[10px] text-slate-500 mt-2"><span class="text-emerald-400">↑ 12%</span> vs last period</p>
                    </div>
                    <div class="salt-card p-4">
                        <p class="metric-label">Active Trackers</p>
                        <h3 class="text-2xl font-bold mt-1 text-blue-500" id="stat-active">0</h3>
                        <p class="text-[10px] text-slate-500 mt-2">Queue latency: 42ms</p>
                    </div>
                    <div class="salt-card p-4">
                        <p class="metric-label">Success Rate</p>
                        <h3 class="text-2xl font-bold mt-1" id="stat-rate">0%</h3>
                        <div class="w-full bg-[#121212] h-1 mt-3 rounded-full overflow-hidden">
                            <div id="rate-bar" class="bg-emerald-500 h-full w-0 transition-all duration-1000"></div>
                        </div>
                    </div>
                    <div class="salt-card p-4 border-l-2 border-rose-500">
                        <p class="metric-label">Validation Errors</p>
                        <h3 class="text-2xl font-bold mt-1 text-rose-500" id="stat-errors">0</h3>
                        <p class="text-[10px] text-slate-500 mt-2">Requires manual review</p>
                    </div>
                </div>

                <!-- Primary Workplace Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    
                    <!-- Left: Ingestion Controller -->
                    <div class="lg:col-span-4 space-y-4">
                        <div class="salt-card p-6 bg-[#1a1a1a]">
                            <h3 class="text-xs font-bold uppercase text-slate-400 mb-6 flex items-center">
                                <i class="fas fa-plus-circle mr-2"></i> New Data Ingestion
                            </h3>
                            
                            <div id="upload-area" class="group border-2 border-dashed border-[#444] rounded p-10 text-center cursor-pointer hover:border-blue-500 hover:bg-blue-900/10 transition-all">
                                <input type="file" id="file-input" class="hidden" multiple>
                                <i class="fas fa-file-arrow-up text-3xl text-slate-600 mb-4 group-hover:text-blue-500 group-hover:scale-110 transition-all"></i>
                                <p class="text-sm font-semibold">Stage Dataset</p>
                                <p class="text-[11px] text-slate-500 mt-2 font-mono">DRAG & DROP OR EXPLORE</p>
                            </div>

                            <div id="active-upload-status" class="mt-6 hidden space-y-3">
                                <div class="flex justify-between items-center">
                                    <span id="active-filename" class="text-xs font-mono text-blue-400 truncate w-32">file.parquet</span>
                                    <span id="active-percent" class="text-xs font-bold">0%</span>
                                </div>
                                <div class="h-1 w-full bg-[#121212] rounded-full overflow-hidden">
                                    <div id="active-progress-bar" class="h-full bg-blue-500 w-0 transition-all"></div>
                                </div>
                            </div>
                        </div>

                        <div class="salt-card p-5 bg-[#121212]">
                            <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-4">Ingestion Policy</h4>
                            <div class="space-y-3">
                                <div class="flex items-start">
                                    <i class="fas fa-check-circle text-emerald-500 text-[10px] mt-1 mr-3"></i>
                                    <p class="text-[11px] text-slate-400">Automatic PII Discovery (Enabled)</p>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-check-circle text-emerald-500 text-[10px] mt-1 mr-3"></i>
                                    <p class="text-[11px] text-slate-400">GDPR Compliance Mapping</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Tracker & History Tabbed Container -->
                    <div class="lg:col-span-8">
                        <div class="salt-card overflow-hidden">
                            <div class="flex items-center px-6 pt-4 border-b border-[#333]">
                                <div class="flex space-x-6 h-full">
                                    <button onclick="switchTab('active')" id="tab-active-btn" class="pb-3 text-xs font-bold uppercase tracking-wider transition-all active-tab">
                                        Live Trackers
                                    </button>
                                    <button onclick="switchTab('history')" id="tab-history-btn" class="pb-3 text-xs font-bold uppercase tracking-wider text-slate-500 transition-all hover:text-white">
                                        History Archive
                                    </button>
                                </div>
                                <div class="ml-auto pb-3 flex items-center space-x-4">
                                    <div class="relative">
                                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-[10px]"></i>
                                        <input type="text" id="search-input" placeholder="SEARCH UUID..." class="salt-input pl-8 pr-4 py-1 text-[10px] font-mono rounded w-48">
                                    </div>
                                    <button id="refresh-btn" class="text-slate-500 hover:text-white transition-all">
                                        <i class="fas fa-arrows-rotate text-xs"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="min-h-[440px]">
                                <table class="w-full text-left border-collapse">
                                    <thead class="salt-table-header">
                                        <tr>
                                            <th class="px-6 py-3 text-[10px] font-bold text-slate-500 uppercase">Asset Name</th>
                                            <th class="px-6 py-3 text-[10px] font-bold text-slate-500 uppercase">UUID Tracker</th>
                                            <th class="px-6 py-3 text-[10px] font-bold text-slate-500 uppercase">Stage Status</th>
                                            <th class="px-6 py-3 text-[10px] font-bold text-slate-500 uppercase text-right">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-body" class="divide-y divide-[#2a2a2a]">
                                        <!-- Content Injected via Script -->
                                    </tbody>
                                </table>
                                
                                <div id="empty-state" class="hidden py-24 flex flex-col items-center justify-center opacity-30">
                                    <i class="fas fa-database text-4xl mb-4"></i>
                                    <p class="text-xs font-bold uppercase tracking-widest">No matching records</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Notification Toast (Salt Alert Component) -->
    <div id="toast" class="fixed top-8 right-8 translate-x-[400px] transition-all duration-500 salt-card p-4 w-72 flex items-start space-x-3 z-[100] shadow-2xl border-l-4">
        <i id="toast-icon" class="fas fa-circle-info mt-1"></i>
        <div>
            <p id="toast-title" class="text-[11px] font-black uppercase tracking-wider mb-0.5">Notification</p>
            <p id="toast-msg" class="text-xs text-slate-400"></p>
        </div>
    </div>

    <script>
        // State
        let tasks = [];
        let currentTab = 'active';
        
        // Configuration
        const REFRESH_RATE = 3000;

        // Elements
        const tableBody = document.getElementById('table-body');
        const emptyState = document.getElementById('empty-state');
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const searchInput = document.getElementById('search-input');
        
        window.addEventListener('DOMContentLoaded', () => {
            loadTasks();
            initEvents();
            updateStats();
            render();
        });

        function initEvents() {
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('border-blue-500', 'bg-blue-900/10');
            });
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('border-blue-500', 'bg-blue-900/10');
            });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('border-blue-500', 'bg-blue-900/10');
                if (e.dataTransfer.files.length) handleFileUpload(e.dataTransfer.files[0]);
            });
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) handleFileUpload(e.target.files[0]);
            });
            searchInput.addEventListener('input', render);
            document.getElementById('refresh-btn').addEventListener('click', () => {
                showToast("Refreshing Catalog...", "info");
                render();
            });
        }

        async function handleFileUpload(file) {
            const statusUI = document.getElementById('active-upload-status');
            const fileNameUI = document.getElementById('active-filename');
            const percentUI = document.getElementById('active-percent');
            const barUI = document.getElementById('active-progress-bar');

            statusUI.classList.remove('hidden');
            fileNameUI.textContent = file.name;

            try {
                const trackerId = await simulateUpload((p) => {
                    percentUI.textContent = `${p}%`;
                    barUI.style.width = `${p}%`;
                });

                const newTask = {
                    id: trackerId,
                    filename: file.name,
                    size: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                    status: 'Processing',
                    progress: 10,
                    timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    details: 'Initialization'
                };

                tasks.unshift(newTask);
                saveTasks();
                showToast("Asset Successfully Staged", "success");
                pollStatus(trackerId);
                render();
                updateStats();

            } catch (err) {
                showToast("Backend Rejection", "error");
            } finally {
                setTimeout(() => {
                    statusUI.classList.add('hidden');
                    barUI.style.width = '0%';
                }, 800);
            }
        }

        function pollStatus(id) {
            const interval = setInterval(() => {
                const task = tasks.find(t => t.id === id);
                if (!task || ['Completed', 'Failed'].includes(task.status)) {
                    clearInterval(interval);
                    return;
                }

                if (task.progress < 100) {
                    task.progress += 20;
                    if (task.progress >= 40) task.details = "Policy Enforcement";
                    if (task.progress >= 80) task.details = "Immuta Syncing";
                }

                if (task.progress >= 100) {
                    task.status = Math.random() > 0.08 ? 'Completed' : 'Failed';
                    task.details = task.status === 'Completed' ? 'Governance Applied' : 'Policy Violation';
                    showToast(`${task.id}: ${task.status}`, task.status.toLowerCase());
                    clearInterval(interval);
                    updateStats();
                }

                saveTasks();
                render();
            }, REFRESH_RATE);
        }

        function render() {
            const query = searchInput.value.toLowerCase();
            const filtered = tasks.filter(t => {
                const isTab = currentTab === 'active' 
                    ? ['Pending', 'Processing'].includes(t.status)
                    : ['Completed', 'Failed'].includes(t.status);
                const isMatch = t.id.toLowerCase().includes(query) || t.filename.toLowerCase().includes(query);
                return isTab && isMatch;
            });

            if (filtered.length === 0) {
                tableBody.innerHTML = '';
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                tableBody.innerHTML = filtered.map(t => `
                    <tr class="group hover:bg-[#252525] transition-colors border-l-2 border-transparent hover:border-blue-500">
                        <td class="px-6 py-4">
                            <div class="flex flex-col">
                                <span class="text-xs font-bold text-white">${t.filename}</span>
                                <span class="text-[10px] text-slate-500 font-mono">${t.size} • ${t.timestamp}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="font-mono text-[10px] text-slate-400">
                                ${t.id}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex flex-col">
                                <div>${getStatusUI(t.status)}</div>
                                <span class="text-[9px] text-slate-500 mt-1 uppercase font-bold">${t.details}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="removeTask('${t.id}')" class="opacity-0 group-hover:opacity-100 p-2 text-slate-600 hover:text-rose-500 transition-all">
                                <i class="fas fa-trash-can text-xs"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        function getStatusUI(status) {
            const map = {
                'Processing': 'bg-blue-500/10 text-blue-500 border-blue-500/20',
                'Completed': 'bg-emerald-500/10 text-emerald-500 border-emerald-500/20',
                'Failed': 'bg-rose-500/10 text-rose-500 border-rose-500/20',
                'Pending': 'bg-slate-500/10 text-slate-500 border-slate-500/20'
            };
            return `<span class="salt-status-pill border ${map[status]}">${status}</span>`;
        }

        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('tab-active-btn').className = `pb-3 text-xs font-bold uppercase tracking-wider transition-all ${tab === 'active' ? 'active-tab' : 'text-slate-500 hover:text-white'}`;
            document.getElementById('tab-history-btn').className = `pb-3 text-xs font-bold uppercase tracking-wider transition-all ${tab === 'history' ? 'active-tab' : 'text-slate-500 hover:text-white'}`;
            render();
        }

        function updateStats() {
            const total = tasks.length;
            const active = tasks.filter(t => ['Pending', 'Processing'].includes(t.status)).length;
            const errors = tasks.filter(t => t.status === 'Failed').length;
            const success = tasks.filter(t => t.status === 'Completed').length;
            const rate = total > 0 ? Math.round((success / (success + errors || 1)) * 100) : 0;

            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-active').textContent = active;
            document.getElementById('stat-errors').textContent = errors;
            document.getElementById('stat-rate').textContent = `${rate}%`;
            document.getElementById('rate-bar').style.width = `${rate}%`;
        }

        function simulateUpload(cb) {
            return new Promise(resolve => {
                let p = 0;
                const timer = setInterval(() => {
                    p += 25;
                    cb(p);
                    if (p >= 100) {
                        clearInterval(timer);
                        resolve('UUID-' + Math.random().toString(16).substring(2, 10).toUpperCase());
                    }
                }, 200);
            });
        }

        function removeTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            saveTasks();
            updateStats();
            render();
        }

        function saveTasks() { localStorage.setItem('immuta_salt_tasks', JSON.stringify(tasks)); }
        function loadTasks() {
            const saved = localStorage.getItem('immuta_salt_tasks');
            if (saved) {
                tasks = JSON.parse(saved);
                tasks.forEach(t => { if (['Pending', 'Processing'].includes(t.status)) pollStatus(t.id); });
            }
        }

        function showToast(msg, type) {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const title = document.getElementById('toast-title');
            const msgBox = document.getElementById('toast-msg');

            const themes = {
                success: { color: 'border-emerald-500', icon: 'fa-circle-check text-emerald-500', title: 'System Success' },
                error: { color: 'border-rose-500', icon: 'fa-circle-exclamation text-rose-500', title: 'Critical Error' },
                info: { color: 'border-blue-500', icon: 'fa-circle-info text-blue-500', title: 'Catalog Update' }
            };

            const theme = themes[type] || themes.info;
            toast.className = toast.className.replace(/border-(emerald|rose|blue)-500/, '') + ' ' + theme.color;
            icon.className = `fas ${theme.icon} mt-1`;
            title.textContent = theme.title;
            msgBox.textContent = msg;

            toast.classList.remove('translate-x-[400px]');
            setTimeout(() => toast.classList.add('translate-x-[400px]'), 3500);
        }
    </script>
</body>
</html>
